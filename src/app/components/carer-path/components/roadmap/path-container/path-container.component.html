<div class="path-container">
  <div class="stage-section" *ngFor="let stage of filteredStages">
    <div class="stage-header"
      [class.active]="activeStages.includes(stage.id)"
      (click)="toggleStage(stage.id)">
      <div class="stage-info">
        <h3 class="stage-title">{{ stage.name }}</h3>
        <div class="stage-stats">
          <span class="completed">{{ getCompletedStepsCount(stage) }}</span>
          <span class="total">/{{ stage.steps.length }} steps</span>
        </div>
      </div>
      <i class="fas"
        [class.fa-chevron-down]="!activeStages.includes(stage.id)"
        [class.fa-chevron-up]="activeStages.includes(stage.id)"></i>
    </div>

    <div class="stage-content" *ngIf="activeStages.includes(stage.id)">
      <div class="step-grid">
        <div class="step-card" *ngFor="let step of stage.steps"
          [class.active]="activeStep === step.id"
          [class.completed]="completedSteps.includes(step.id)"
          [class.in-progress]="inProgressSteps.includes(step.id)">

          <div class="step-header" (click)="toggleStep(step.id)">
            <div class="step-icon" [style.background]="step.color">
              <i [class]="step.icon"></i>
            </div>

            <div class="step-info">
              <h4 class="step-title">{{ step.title }}</h4>
              <div class="step-meta">
                <span class="duration" *ngIf="step.duration">
                  <i class="fas fa-clock"></i> {{ step.duration }}
                </span>
                <span class="level" *ngIf="step.level">
                  <i class="fas fa-signal"></i> {{ step.level }}
                </span>
              </div>
            </div>

            <div class="step-status">
              <span class="status-badge completed"
                *ngIf="completedSteps.includes(step.id)">
                <i class="fas fa-check-circle"></i> Completed
              </span>
              <span class="status-badge in-progress"
                *ngIf="inProgressSteps.includes(step.id) && !completedSteps.includes(step.id)">
                <i class="fas fa-spinner fa-pulse"></i> In Progress
              </span>
            </div>
          </div>

          <div class="step-details" *ngIf="activeStep === step.id">
            <div class="step-description">
              <p>{{ step.description }}</p>
            </div>

            <div class="step-skills" *ngIf="step.skills?.length">
              <h5><i class="fas fa-lightbulb"></i> Skills You'll Learn</h5>
              <div class="skills-list">
                <span *ngFor="let skill of step.skills"
                  class="skill-tag"
                  matTooltipClass="custom-tooltip"
                  [class.completed]="getSkillStatus(skill.id) === 'completed'"
                  [class.in-progress]="getSkillStatus(skill.id) === 'in-progress'"
                  [class.not-started]="getSkillStatus(skill.id) === 'start' && (!inProgressSteps.includes(step.id) && !completedSteps.includes(step.id))"
                  [matTooltip]="getSkillTooltip(getSkillStatus(skill.id), step.id)"
                  (click)="openSkillModal(skill, step.id)">
                  {{ skill.name }}
                  <i class="fas"
                    [class.fa-check-circle]="getSkillStatus(skill.id) === 'completed'"
                    [class.fa-spinner]="getSkillStatus(skill.id) === 'in-progress'"
                    [class.fa-play]="getSkillStatus(skill.id) === 'start'"></i>
                </span>
              </div>
            </div>

            <div class="step-resources" *ngIf="step.resources?.length">
              <h5><i class="fas fa-link"></i> Resources</h5>
              <div class="resources-list">
                <a *ngFor="let resource of step.resources"
                  [href]="resource.url" target="_blank" class="resource-link">
                  <i [class]="resource.icon"></i> {{ resource.name }}
                </a>
              </div>
            </div>

            <div class="step-actions">
              <button class="btn-start"
                *ngIf="!inProgressSteps.includes(step.id) && !completedSteps.includes(step.id)"
                (click)="startStep(step.id)">
                <i class="fas fa-play"></i> Begin Step
              </button>

              <button class="btn-complete"
                *ngIf="inProgressSteps.includes(step.id) && !completedSteps.includes(step.id)"
                (click)="completeStep(step.id)">
                <i class="fas fa-check"></i> Mark Complete
              </button>

              <div class="completed-actions"
                *ngIf="completedSteps.includes(step.id)">
                <button class="btn-reset" (click)="resetStep(step.id)">
                  <i class="fas fa-undo"></i> Reset Step
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="empty-state" *ngIf="filteredStages.length === 0">
    <div class="empty-icon">
      <i class="fas fa-search"></i>
    </div>
    <h4>No Learning Paths Found</h4>
    <p>Try adjusting your filter criteria</p>
    <button class="btn-reset-filters" (click)="resetFilters()">
      <i class="fas fa-filter"></i> Reset Filters
    </button>
  </div>

  <skill-modal
    *ngIf="selectedSkill"
    [(visible)]="showSkillModal"
    [skill]="selectedSkill"
    (statusChange)="onSkillStatusChange($event)">
  </skill-modal>
</div>
